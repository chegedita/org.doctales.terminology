<?xml version="1.0" encoding="UTF-8"?>
<project xmlns:dita="http://dita-ot.sourceforge.net">
    <target name="is.com.oxygen.webhelp.available">
        <fail message="The plugin com.oxygen.webhelp is not available">
            <condition>
                <not>
                    <isset property="dita.plugin.com.oxygenxml.dita-ot.plugin.webhelp.dir"/>
                </not>
            </condition>
        </fail>
    </target>
    <target name="dita2termbrowser" depends="is.com.oxygen.webhelp.available">
        <delete dir="${dita.temp.dir}"/>
        <delete dir="${output.dir}"/>
        <antcall target="dita2webhelp"/>
        <basename property="semantic-net" file="${args.input}" suffix=".ditamap"/>
        <xslt basedir="${dita.temp.dir}"
            destdir="${output.dir}"
            in="${dita.temp.dir}${file.separator}${semantic-net}.ditamap"
            out="${dita.temp.dir}${file.separator}${semantic-net}_net.html"
            reloadstylesheet="${dita.xhtml.reloadstylesheet}"
            classpathref="dost.class.path"
            extension=".html"
            style="${dita.plugin.org.doctales.terminology.dir}/xsl/terminology2termgraph.xsl"
            filenameparameter="FILENAME" 
            filedirparameter="FILEDIR">
            <xmlcatalog refid="dita.catalog"/>
        </xslt>
        <!--<loadfile srcfile="${dita.temp.dir}${file.separator}${semantic-net}_net.html" property="semantic-net.file"/>-->
        <!--},]-->
        <replaceregexp file="${dita.temp.dir}\${semantic-net}_net.html" match="\[[/\r?\n|\r/]*\s+\,*\{" replace="[{" flags="g"/>
        <replaceregexp file="${dita.temp.dir}\${semantic-net}_net.html" match="\}\,*[/\r?\n|\r/]*\s+\]" replace="}]" flags="g"/>
        <!--<replaceregexp file="${dita.temp.dir}\${semantic-net}_net.html" match="\s+" replace=" " flags="g" byline="true"/>-->
        <copy file="${dita.temp.dir}${file.separator}${semantic-net}_net.html" todir="${output.dir}"/>
    </target>
</project>
